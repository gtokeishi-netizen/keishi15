# 🧪 市町村システム動作テスト手順

## 1. 管理画面でのテスト

### 助成金作成画面での確認
1. **助成金** → **新規追加**
2. 右側メタボックスで「地域制限」セクションを確認
3. **都道府県レベル**を選択 → 都道府県チェックボックスが表示
4. **市町村レベル**を選択 → 市町村選択インターフェースが表示
5. 都道府県を選択 → 対応する市町村が動的に表示されることを確認

### 具体的テストケース
- **東京都**を選択 → 23区 + 市部の市町村が表示
- **大阪府**を選択 → 大阪市各区 + 府内市町村が表示
- **北海道**を選択 → 札幌市各区 + 道内市町村が表示

## 2. フロントエンドでのテスト

### 助成金アーカイブページ
1. `/grant/`（助成金一覧ページ）にアクセス
2. フィルターセクションで都道府県を選択
3. 市町村フィルターが動的に更新されることを確認
4. 選択した条件で検索結果が絞り込まれることを確認

## 3. AJAX機能のテスト

### ブラウザの開発者ツールで確認
1. F12で開発者ツールを開く
2. Networkタブで以下のAJAXリクエストを確認：
   - `gi_ajax_get_municipalities_for_prefectures`
   - `gi_load_grants`

### 期待される動作
- 都道府県選択時にAJAXリクエストが送信される
- 市町村データが正常に返される
- UIが即座に更新される
- エラーが発生しない

## 4. デバッグ情報

### 問題が発生した場合の確認点

#### WordPressデバッグモード
```php
// wp-config.phpに以下を追加
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
```

#### ログファイルの確認
- `/wp-content/debug.log`
- エラーメッセージの確認

#### データベース確認
- `wp_terms`テーブルに市町村データが作成されているか
- `wp_term_taxonomy`で正しいタクソノミーが設定されているか

## 5. トラブルシューティング

### よくある問題と解決法

#### 市町村データが表示されない
1. テーマアクティベーション後、一度ダッシュボードを再読み込み
2. パーマリンク設定の更新（**設定** → **パーマリンク** → **保存**）

#### AJAX が動作しない
1. jQuery が正しく読み込まれているか確認
2. admin-ajax.php への通信が可能か確認
3. nonceの設定が正しいか確認

#### タクソノミーが表示されない
1. `flush_rewrite_rules()`の実行
2. テーマの再アクティベーション

## 6. 成功確認ポイント

### ✅ 正常動作の指標
- [ ] 管理画面で都道府県選択時に市町村が動的表示される
- [ ] フロントエンドで県選択時に市町村フィルターが更新される
- [ ] 検索結果が正しく絞り込まれる
- [ ] JavaScript エラーが発生しない
- [ ] AJAX通信が正常に完了する
- [ ] 全47都道府県の市町村データが利用可能

### 📊 パフォーマンス指標
- 都道府県選択から市町村表示まで1秒以内
- AJAX通信のレスポンスが2秒以内
- ページの読み込み速度に影響しない